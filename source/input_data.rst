==========================
Входные данные о квартирах
==========================

Данные о квартирах (или о других конечных объектах недвижимости) могут
предоставляться в одном из трех форматов:

* :ref:`JSON <JSON>` (наиболее предпочтительный)
* :ref:`XML <XML>`
* :ref:`CSV <CSV>`

Помимо вышеуказанной выдачи следует предоставить комментарии по необходимости:

* валюта, в которой указаны цены
* значения :doc:`параметров квартиры </attributes>` по умолчанию, если нет данных

.. _JSON:

Данные в формате JSON
=====================

`JSON (wikipedia) <http://ru.wikipedia.org/wiki/JSON>`_ - простой, легко читаемый и в то же время надежный формат передачи данных,
в силу чего сейчас набирает все больше популярности. И следовательно, для его
обработки производится масса качественного ПО на многих языках.

.. highlight:: javascript

Мы принимаем данные в этом формате, с очень простой структурой: *массив/список
объектов с определенными* :doc:`параметрами </attributes>`. Каждый объект
описывает квартиру, дом и т.д.

В следующем примере выдачи - три квартиры, находящиеся на 1-ом этаже 2-ой
секции 3-го корпуса 4-ой очереди::

    [
        {
            "quarter_number": 4,
            "building_number": 3,
            "section_number": 2,
            "floor_number": 1,
            "number": 1,
            "room_count": 2,
            "square": 34.6,
            "status": 1,
            "cost_per_meter": 5200.78
        },
        {
            "quarter_number": 4,
            "building_number": 3,
            "section_number": 2,
            "floor_number": 1,
            "number": 2,
            "room_count": 4,
            "square": 94.67,
            "status": 1,
            "cost_per_meter": 5200.78
        },
        {
            "quarter_number": 4,
            "building_number": 3,
            "section_number": 2,
            "floor_number": 1,
            "number": 3,
            "room_count": 3,
            "square": 60.1,
            "status": 1,
            "cost_per_meter": 5200.78
        },
    ]

.. note::
   Порядок объектов не имеет значения.


.. _site-json:

Формат JSON для прямого подключения к сайту
-------------------------------------------

.. highlight:: javascript

Если имеется возможность выложить JSON на `публичный сервер`, способный
выдерживать базовую нагрузку, мы можем подключить его непсредственно к вашему
сайту и это даст следующие преимущества:

* отпадает необходимость нашего участия в обновлении данных по запросу - на
  вашем сайте *всегда отображаются актуальные данные*

Для корректной работы в JSON-выдачу "для сайта" нужно внести следующие
изменения:

* заменить полные имена :doc:`параметров </attributes>` на сокращенные
  (для сокращения объема файла)
* каждый объект квартиры должен иметь :doc:`уникальный идентификатор </id>`
  и, следовательно, выдача превращается из простого массива в ассоциативный
* убрать всякое форматирование (пробелы, переносы строки) для максимального
  сжатия файла

Пример приведенной выше выдачи в формате "для сайта" (не применено сжатие для
читаемости)::

    {
     "4-3-1": {
         "q": 4,
         "b": 3,
         "s": 2,
         "f": 1,
         "n": 1,
         "rc": 2,
         "sq": 34.6,
         "st": 1,
         "cpm": 5200.78
     },
     "4-3-2": {
         "q": 4,
         "b": 3,
         "s": 2,
         "f": 1,
         "n": 2,
         "rc": 4,
         "sq": 94.67,
         "st": 1,
         "cpm": 5200.78
      },
     "4-3-3": {
         "q": 4,
         "b": 3,
         "s": 2,
         "f": 1,
         "n": 3,
         "rc": 3,
         "sq": 60.1,
         "st": 1,
         "cpm": 5200.78
     }
    }

``4-3-1``, ``4-3-2`` и ``4-3-3`` - :doc:`уникальные идентификаторы </id>`,
состоящие из номера `очереди`, номера `корпуса` и номера `квартиры`


.. _XML:

Данные в формате XML
====================

`XML (wikipedia) <http://ru.wikipedia.org/wiki/XML>`_ - формат, который используется уже много лет для описания любого рода
данных. На нем основаны такие популярные форматы как `HTML`, `SVG` и др. Он
максимально структурирован, типизирован, однако часто сложен для чтения человеком.

.. highlight:: xml

Мы принимаем XML-данные с простейшей структурой, где в корневом элементе
находятся элементы квартиры с :doc:`параметрами </attributes>`::

    <?xml version="1.0" encoding="UTF-8"?>
    <data>
        <apartment
                quarter_number="1"
                building_number="1"
                section_number="1"
                floor_number="1"
                number="1"
                square="56.7"
                room_count="3"
                total_cost="3456321"
                cost_per_meter="1200"
                status="1"
                note=""/>
        <apartment
                quarter_number="1"
                building_number="1"
                section_number="1"
                floor_number="1"
                number="2"
                square="56.7"
                room_count="3"
                total_cost="3456321"
                cost_per_meter="1200"
                status="1"
                note=""/>
        <apartment
                quarter_number="1"
                building_number="1"
                section_number="1"
                floor_number="1"
                number="2"
                square="86.7"
                room_count="4"
                total_cost="5456321"
                cost_per_meter="1200"
                status="1"
                note=""/>
    </data>


.. _CSV:

Данные в формате CSV
====================

Формат `CSV (wikipedia) <http://ru.wikipedia.org/wiki/CSV>`_ содержит "табличные" данные в
простом текстовом файле. Если нет возможности предоставлять данные в форматах
:ref:`JSON` и :ref:`XML` - этот формат будет удовлетворительной
заменой. Множество офисных приложений (Excel, LibreOffice Calc), систем
управления базами данных (MySQL, SQLite, Oracle и др.) предоставляют экспорт
данных в CSV.

Единственным нашим требованием к выдаче является наличие `заголовков`.
Заголовки желательно указать в соответствии с :doc:`названиями параметров
</attributes>` квартиры.

Допустим, у нас есть таблица:

====== ====== ==== ===== ============= ======= ======
корпус секция этаж номер кол-во комнат площадь статус
====== ====== ==== ===== ============= ======= ======
1      1      1    1     3             96.7    0
1      1      1    2     1             54.2    1
1      1      1    3     2             66.3    0
1      1      1    4     3             97.9    0
====== ====== ==== ===== ============= ======= ======


Тогда выдача в CSV будет выглядеть следующим образом::

    building_number,section_number,floor_number,number,room_count,square,status
    1,1,1,1,3,96.7,0
    1,1,1,2,1,54.2,1
    1,1,1,3,2,66.3,0
    1,1,1,4,3,97.9,0


.. warning::
   Обратите внимание на то, что значения площади указаны в английской локали
   (через точку). Мы рекомендуем все дробные значения указывать таким образом.